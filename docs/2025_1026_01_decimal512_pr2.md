# Decimal512 支持（PR-2：测试与示例）

## 改动目标
- 为 Decimal512 添加完整的集成测试（包括 Native 和 HTTP 协议）
- 为 database/sql 接口添加 Decimal512 测试
- 更新示例代码，展示 Decimal512 的使用方法
- 修复 go.mod 中的 ch-go 依赖引用

## 实现方案

### 1. 集成测试（tests/decimal512_test.go）
新增完整的集成测试，涵盖：
- **基础读写测试**：测试 Decimal(77-154) 精度范围的基本读写功能
- **负数与 Nullable 测试**：测试负数值和 NULL 值的处理
- **数组支持测试**：测试 Array(Decimal512) 类型
- **字符串输入测试**：测试从字符串解析 Decimal512 值

### 2. std 测试（tests/std/decimal512_test.go）
为 database/sql 接口添加测试：
- **标准接口测试**：通过 database/sql 接口测试 Decimal512 的读写
- **列元数据测试**：验证 Precision 和 Scale 的正确性
- **Nullable 测试**：测试可空列的 NULL 值处理
- **字符串输入测试**：测试通过 Exec 传入字符串参数

### 3. 示例代码更新（examples/clickhouse_api/decimal.go）
在示例中添加 Decimal512 的使用：
- 添加 Col6 列，使用 Decimal512(20) 类型
- 展示如何使用 `decimal.RequireFromString` 处理大数值
- 演示精度超过 76 位的场景

### 4. go.mod 修复
- 将 ch-go 的 replace 指向改为本地路径 `/root/ch-go`
- 解决了远程 fork 仓库版本不存在的问题
- 运行 `go mod tidy` 更新依赖

## 影响范围
- 新增测试文件不影响现有功能
- 示例代码的修改向后兼容（只是添加了新列）
- go.mod 的修改仅在开发环境生效，不影响最终用户

## 测试覆盖
1. **列类型选择测试**：验证 Decimal(76/77/154/155) 的边界处理
2. **基础读写测试**：Native 和 HTTP 协议下的基本操作
3. **Nullable 测试**：NULL 值的正确处理
4. **数组测试**：Array(Decimal512) 的读写
5. **database/sql 测试**：标准接口的完整支持
6. **字符串输入测试**：字符串到 Decimal 的转换

## 问题与思考
- 测试需要 ClickHouse 24.8+ 版本，因为 Decimal512 是新增特性
- 测试中使用了 `CheckMinServerServerVersion` 来跳过不支持的版本
- 所有测试都包含了精度和 scale 的边界情况
- 后续 PR-3 将处理更复杂的复合类型（Tuple、Map 等）

## 验证方法
```bash
# 运行列选择测试（不需要 Docker）
go test -run Test_Decimal512_Column_SelectByPrecision ./tests/decimal512_pr1_test.go ./tests/package.go -v

# 运行完整集成测试（需要 ClickHouse 服务）
go test ./tests -run Decimal512 -v

# 运行 std 测试
go test ./tests/std -run Decimal512 -v
```

